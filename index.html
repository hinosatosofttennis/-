<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒ¯ã‚¤ãƒ³ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ - ãƒ‡ãƒ¢</title>

  <!-- Tailwind Play CDNï¼ˆé–‹ç™ºãƒ»ãƒ‡ãƒ¢ç”¨ã€‚å®Ÿé‹ç”¨æ™‚ã¯ãƒ“ãƒ«ãƒ‰å°å…¥ã‚’æ¨å¥¨ï¼‰-->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React / ReactDOMï¼ˆUMDï¼‰ + Babelï¼ˆJSXã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å¤‰æ›ï¼‰-->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* è»½ã„è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    /* å±¥æ­´ã‚«ãƒ¼ãƒ‰ã®é–‹é–‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .collapse-enter { max-height: 0; opacity: 0; transition: max-height .22s ease, opacity .22s ease; overflow: hidden; }
    .collapse-enter-active { max-height: 800px; opacity: 1; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root" class="min-h-screen p-4"></div>

  <script type="text/babel">
  const { useState, useEffect } = React;

  const SECTIONS = [
    {
      key: "visual",
      title: "è¦‹ã‚‹ (Visual)",
      items: [
        "è‰²ã¯ï¼Ÿï¼ˆãƒ¬ãƒ¢ãƒ³/ã‚´ãƒ¼ãƒ«ãƒ‰/ç¥ç€ç­‰ï¼‰",
        "è¼ãã‚„é€æ˜æ„Ÿã¯ã‚ã‚‹ï¼Ÿ",
        "ã‚°ãƒ©ã‚¹ã‚’å‚¾ã‘ãŸã¨ãã®æ¶™ï¼ˆè„šï¼‰ã¯ï¼Ÿï¼ˆå¤šã„/å°‘ãªã„ï¼‰"
      ]
    },
    {
      key: "nose",
      title: "é¦™ã‚‹ (Nose)",
      items: [
        "ç¬¬ä¸€å°è±¡ã‚’æ„Ÿã˜ãŸï¼Ÿ",
        "ã‚¹ãƒ¯ãƒªãƒ³ã‚°ã—ã¦é¦™ã‚Šã‚’åºƒã’ãŸï¼Ÿ",
        "æœå®Ÿã‚„èŠ±ã®é¦™ã‚Šã¯ï¼Ÿï¼ˆæŸ‘æ©˜/ãƒ™ãƒªãƒ¼/ç™½ã„èŠ±ç­‰ï¼‰",
        "ãã®ä»–ã®é¦™ã‚Šï¼ˆãƒãƒ‹ãƒ©/ã‚¹ãƒ‘ã‚¤ã‚¹/åœŸ/èœ‚èœœç­‰ï¼‰ã¯ï¼Ÿ"
      ]
    },
    {
      key: "palate",
      title: "å‘³ã‚ã† (Palate)",
      items: [
        "é…¸å‘³ã¯ï¼Ÿï¼ˆçˆ½ã‚„ã‹/ç©ã‚„ã‹ï¼‰",
        "ç”˜ã¿ã¯ï¼Ÿï¼ˆè¾›å£/ã‚„ã‚„ç”˜å£/ç”˜å£ï¼‰",
        "æ¸‹ã¿ï¼ˆã‚¿ãƒ³ãƒ‹ãƒ³ï¼‰ã¯ï¼Ÿï¼ˆãªã‚ã‚‰ã‹/ã—ã£ã‹ã‚Šï¼‰",
        "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ„Ÿã¯ï¼Ÿï¼ˆè»½ã‚„ã‹/æ¸©ã‹ã¿/å¼·ã„ï¼‰",
        "ä½™éŸ»ã¯ï¼Ÿï¼ˆçŸ­ã„/ä¸­ãã‚‰ã„/é•·ã„ï¼‰"
      ]
    },
    {
      key: "impression",
      title: "ã¾ã¨ã‚ (Impression)",
      items: [
        "è»½å¿«ï¼Ÿã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆï¼ŸåŠ›å¼·ã„ï¼Ÿ",
        "å¥½ããªã‚¿ã‚¤ãƒ—ã ã£ãŸï¼Ÿ",
        "åˆã‚ã›ãŸã„æ–™ç†ã¯ä½•ï¼Ÿ"
      ]
    }
  ];

  const STORAGE_KEY = "wineTastingHistory_v1";

  function useLocalHistory() {
    const [history, setHistory] = useState([]);
    useEffect(() => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) setHistory(JSON.parse(raw));
      } catch (e) {
        console.error("localStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼", e);
      }
    }, []);
    useEffect(() => {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
      } catch (e) {
        console.error("localStorageä¿å­˜ã‚¨ãƒ©ãƒ¼", e);
      }
    }, [history]);
    return [history, setHistory];
  }

  function formatDate(iso) {
    const d = new Date(iso);
    return d.toLocaleString();
  }

  function App() {
    const [checks, setChecks] = useState({});
    const [memo, setMemo] = useState("");
    const [wineName, setWineName] = useState("");
    const [history, setHistory] = useLocalHistory();
    const [query, setQuery] = useState("");

    // toggle check state
    function toggle(sectionKey, itemIndex) {
      setChecks(prev => {
        const sec = prev[sectionKey] ? { ...prev[sectionKey] } : {};
        sec[itemIndex] = !sec[itemIndex];
        return { ...prev, [sectionKey]: sec };
      });
    }

    function saveEntry() {
      const entry = {
        id: Date.now(),
        date: new Date().toISOString(),
        wineName: wineName.trim(),
        checks,
        memo: memo.trim()
      };
      setHistory([entry, ...history]);
      // reset
      setChecks({});
      setMemo("");
      setWineName("");
      // å°ã•ãªæ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆãƒ¢ãƒã‚¤ãƒ«å‘ã‘ï¼‰
      window.navigator.vibrate?.(50);
    }

    function deleteEntry(id) {
      if (!confirm("ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      setHistory(history.filter(h => h.id !== id));
    }

    function exportJSON() {
      const blob = new Blob([JSON.stringify(history, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "wine_tasting_history.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (!Array.isArray(data)) throw new Error("é…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“");
          // ç°¡å˜ã«ãƒãƒ¼ã‚¸ã—ã¦ä¸Šæ›¸ã
          setHistory([...data, ...history]);
          alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼ˆä¸Šæ›¸ãã§ã¯ãªãæ–°ã—ã„å±¥æ­´ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼‰");
        } catch (err) {
          alert("JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + err.message);
        }
      };
      reader.readAsText(file);
    }

    const filtered = history.filter(h => {
      const q = query.trim().toLowerCase();
      if (!q) return true;
      return (h.wineName || "").toLowerCase().includes(q) || (h.memo || "").toLowerCase().includes(q);
    });

    return (
      <div className="max-w-3xl mx-auto">
        <header className="sticky top-0 bg-slate-50 pt-4 pb-2 -mx-4 px-4 border-b border-slate-200 z-20">
          <h1 className="text-2xl font-bold">ğŸ· ãƒ¯ã‚¤ãƒ³ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯</h1>
          <p className="text-sm text-slate-600 mt-1">ã‚¿ãƒƒãƒ—ã§ãƒã‚§ãƒƒã‚¯ â†’ ä¿å­˜ã—ã¦å±¥æ­´ã‚’æ®‹ã›ã¾ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</p>
        </header>

        <main className="space-y-4 mt-4 pb-16">
          <section className="bg-white rounded-lg shadow p-4">
            <label className="block text-sm text-slate-700 mb-2">ãƒ¯ã‚¤ãƒ³åï¼ˆä»»æ„ï¼‰</label>
            <input
              className="w-full border rounded px-3 py-2 mb-3 focus:outline-none focus:ring"
              value={wineName}
              onChange={e => setWineName(e.target.value)}
              placeholder="ä¾‹ï¼šãƒ”ãƒãƒ»ãƒãƒ¯ãƒ¼ãƒ« 2020"
            />

            {SECTIONS.map(sec => (
              <div key={sec.key} className="mb-4">
                <h2 className="font-semibold mb-2">{sec.title}</h2>
                <div className="grid gap-2">
                  {sec.items.map((it, idx) => {
                    const checked = !!(checks[sec.key] && checks[sec.key][idx]);
                    return (
                      <button
                        key={idx}
                        onClick={() => toggle(sec.key, idx)}
                        className={`text-left rounded p-2 border flex items-center justify-between gap-3
                          ${checked ? "bg-rose-50 border-rose-200" : "bg-white border-slate-200"}
                          focus:outline-none`}
                        aria-pressed={checked}
                      >
                        <div>
                          <div className="text-sm">{it}</div>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="text-xs text-slate-500">{checked ? "âœ“" : ""}</span>
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>
            ))}

            <div className="mb-3">
              <label className="block text-sm text-slate-700 mb-2">ãƒ¡ãƒ¢</label>
              <textarea
                rows="3"
                className="w-full border rounded px-3 py-2 focus:outline-none focus:ring"
                value={memo}
                onChange={e => setMemo(e.target.value)}
                placeholder="é¦™ã‚Šãƒ»å‘³ã®å°è±¡ã‚„åˆã‚ã›ãŸã„æ–™ç†ãªã©ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„"
              />
            </div>

            <div className="flex flex-wrap gap-2">
              <button
                onClick={saveEntry}
                className="bg-rose-600 text-white px-4 py-2 rounded shadow-sm hover:bg-rose-700"
              >
                ä¿å­˜
              </button>
              <button
                onClick={() => { setChecks({}); setMemo(""); setWineName(""); }}
                className="bg-white border px-4 py-2 rounded hover:bg-slate-50"
              >
                ãƒªã‚»ãƒƒãƒˆ
              </button>

              <button
                onClick={exportJSON}
                className="ml-auto bg-slate-800 text-white px-3 py-2 rounded hidden sm:inline-block"
                title="å±¥æ­´ã‚’JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
              >
                ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
              </button>

              <label className="bg-white border px-3 py-2 rounded cursor-pointer">
                ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                <input
                  type="file"
                  accept="application/json"
                  onChange={e => importJSON(e.target.files?.[0])}
                  className="hidden"
                />
              </label>
            </div>
          </section>

          <section className="flex items-center justify-between">
            <h2 className="text-xl font-semibold">å±¥æ­´</h2>
            <input
              className="border rounded px-2 py-1 w-48"
              placeholder="æ¤œç´¢ï¼ˆãƒ¯ã‚¤ãƒ³åãƒ»ãƒ¡ãƒ¢ï¼‰"
              value={query}
              onChange={e => setQuery(e.target.value)}
            />
          </section>

          <section className="space-y-3">
            {filtered.length === 0 ? (
              <div className="text-sm text-slate-500 bg-white p-4 rounded border">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
            ) : (
              filtered.map(entry => <HistoryCard key={entry.id} entry={entry} onDelete={() => deleteEntry(entry.id)} />)
            )}
          </section>
        </main>

        <footer className="text-center text-xs text-slate-500 pb-8">
          â€»ãƒ‡ãƒ¼ã‚¿ã¯ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ç«¯æœ«ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å¤‰ãˆã‚‹ã¨åŒæœŸã•ã‚Œã¾ã›ã‚“ã€‚
        </footer>
      </div>
    );
  }

  function HistoryCard({ entry, onDelete }) {
    const [open, setOpen] = useState(false);
    return (
      <article className="bg-white border rounded-lg shadow-sm p-4">
        <div className="flex items-start gap-3">
          <div className="flex-1">
            <div className="flex items-baseline justify-between gap-2">
              <div>
                <div className="text-sm text-slate-500">{formatDate(entry.date)}</div>
                <div className="font-medium">{entry.wineName || <span className="text-slate-400">ï¼ˆãƒ¯ã‚¤ãƒ³åæœªè¨˜å…¥ï¼‰</span>}</div>
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setOpen(o => !o)}
                  className="text-sm px-2 py-1 border rounded"
                >
                  {open ? "é–‰ã˜ã‚‹" : "è©³ç´°"}
                </button>
                <button
                  onClick={onDelete}
                  className="text-sm px-2 py-1 border rounded text-red-600"
                >
                  å‰Šé™¤
                </button>
              </div>
            </div>

            <div className="mt-2 text-sm text-slate-700">{entry.memo || <span className="text-slate-400">ï¼ˆãƒ¡ãƒ¢ãªã—ï¼‰</span>}</div>

            {open && (
              <div className="mt-3 border-t pt-3 text-sm text-slate-700 space-y-2">
                {Object.keys(entry.checks || {}).length === 0 ? (
                  <div className="text-slate-500">ãƒã‚§ãƒƒã‚¯é …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
                ) : (
                  Object.entries(entry.checks).map(([secKey, items]) => (
                    <div key={secKey}>
                      <div className="font-semibold mb-1 capitalize">{sectionTitleByKey(secKey)}</div>
                      <ul className="grid gap-1">
                        {Object.entries(items).map(([idx, v]) => (
                          <li key={idx} className="flex items-center gap-2">
                            <span className="w-4">{v ? "âœ“" : "â€”"}</span>
                            <span className="text-slate-600">{itemLabelByKeyIndex(secKey, Number(idx))}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  ))
                )}
              </div>
            )}
          </div>
        </div>
      </article>
    );
  }

  function sectionTitleByKey(key) {
    const f = SECTIONS.find(s => s.key === key);
    return f ? f.title : key;
  }
  function itemLabelByKeyIndex(key, idx) {
    const s = SECTIONS.find(s => s.key === key);
    if (!s) return idx;
    return s.items[idx] || `é …ç›® ${idx+1}`;
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
