import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";

const sections = [
  {
    title: "Ë¶ã„Çã (Visual)",
    items: [
      "Ëâ≤„ÅØÔºü",
      "Ëºù„Åç„ÇÑÈÄèÊòéÊÑü„ÅØ„ÅÇ„ÇãÔºü",
      "Ê∂ôÔºàËÑöÔºâ„ÅØÔºü"
    ]
  },
  {
    title: "È¶ô„Çã (Nose)",
    items: [
      "Á¨¨‰∏ÄÂç∞Ë±°„ÇíÊÑü„Åò„ÅüÔºü",
      "„Çπ„ÉØ„É™„É≥„Ç∞„Åó„Å¶È¶ô„Çä„ÇíÈñã„ÅÑ„ÅüÔºü",
      "ÊûúÂÆü„ÇÑËä±„ÅÆÈ¶ô„Çä„ÇíÊÑü„Åò„ÇãÔºü",
      "„Åù„ÅÆ‰ªñ„ÅÆÈ¶ô„Çä„ÅØÔºü"
    ]
  },
  {
    title: "Âë≥„Çè„ÅÜ (Palate)",
    items: [
      "ÈÖ∏Âë≥„ÅØÔºü",
      "Áîò„Åø„ÅØÔºü",
      "Ê∏ã„Åø„ÅØÔºü",
      "„Ç¢„É´„Ç≥„Éº„É´ÊÑü„ÅØÔºü",
      "‰ΩôÈüª„ÅØÔºü"
    ]
  },
  {
    title: "„Åæ„Å®„ÇÅ (Impression)",
    items: [
      "ËªΩÂø´Ôºü„Ç®„É¨„Ç¨„É≥„ÉàÔºüÂäõÂº∑„ÅÑÔºü",
      "Â•Ω„Åç„Å™„Çø„Ç§„Éó„Å†„Å£„ÅüÔºü",
      "Âêà„Çè„Åõ„Åü„ÅÑÊñôÁêÜ„ÅØÔºü"
    ]
  }
];

export default function WineTastingApp() {
  const [checks, setChecks] = useState({});
  const [memo, setMemo] = useState("");
  const [history, setHistory] = useState([]);

  useEffect(() => {
    const saved = localStorage.getItem("wineHistory");
    if (saved) setHistory(JSON.parse(saved));
  }, []);

  const toggleCheck = (section, item) => {
    setChecks(prev => ({
      ...prev,
      [section]: {
        ...prev[section],
        [item]: !prev[section]?.[item]
      }
    }));
  };

  const saveResult = () => {
    const entry = {
      date: new Date().toLocaleString(),
      checks,
      memo
    };
    const newHistory = [entry, ...history];
    setHistory(newHistory);
    localStorage.setItem("wineHistory", JSON.stringify(newHistory));
    setChecks({});
    setMemo("");
  };

  return (
    <div className="p-4 max-w-3xl mx-auto space-y-6">
      <h1 className="text-2xl font-bold">üç∑ „ÉØ„Ç§„É≥„ÉÜ„Ç§„Çπ„ÉÜ„Ç£„É≥„Ç∞„ÉÅ„Çß„ÉÉ„ÇØ</h1>

      {sections.map(sec => (
        <Card key={sec.title} className="shadow-md">
          <CardContent className="p-4">
            <h2 className="font-semibold mb-2">{sec.title}</h2>
            <ul className="space-y-2">
              {sec.items.map(item => (
                <li key={item}>
                  <label className="flex items-center gap-2">
                    <input
                      type="checkbox"
                      checked={checks[sec.title]?.[item] || false}
                      onChange={() => toggleCheck(sec.title, item)}
                    />
                    {item}
                  </label>
                </li>
              ))}
            </ul>
          </CardContent>
        </Card>
      ))}

      <Card>
        <CardContent className="p-4">
          <h2 className="font-semibold mb-2">„É°„É¢</h2>
          <textarea
            className="w-full border rounded p-2"
            rows="3"
            value={memo}
            onChange={e => setMemo(e.target.value)}
          />
        </CardContent>
      </Card>

      <Button onClick={saveResult}>‰øùÂ≠ò</Button>

      <h2 className="text-xl font-bold mt-6">Â±•Ê≠¥</h2>
      <div className="space-y-4">
        {history.map((h, i) => (
          <Card key={i}>
            <CardContent className="p-4">
              <p className="text-sm text-gray-500">{h.date}</p>
              <p className="mt-2">{h.memo}</p>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
